[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[unix_http_server]
file = /tmp/neutron-opflex-supervisord.sock

[supervisorctl]
serverurl = unix:///tmp/neutron-opflex-supervisord.sock
prompt = ciscoaci-neutron-opflex

[supervisord]
identifier = neutron-opflex-supervisor
pidfile = /tmp/neutron-opflex-supervisord.pid
logfile = /var/log/neutron/neutron-opflex-supervisord.log
logfile_maxbytes = 10MB
logfile_backups = 3
loglevel = debug
childlogdir = /var/log/neutron
umask = 022
minfds = 1024
minprocs = 200
nodaemon = true
nocleanup = false
strip_ansi = false

[program:neutron-opflex-agent]
command=/usr/bin/neutron-opflex-agent --config-file /usr/share/neutron/neutron-dist.conf --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/neutron_opflex.conf --log-file /var/log/neutron/neutron-opflex-agent.log
exitcodes=0,2
priority=100
stopasgroup=true
startsecs=10
startretries=3
stopwaitsecs=10
stdout_logfile=NONE
stderr_logfile=NONE
user=neutron

[program:monitor-ovs]
command=/bin/sh -c "while true; do sleep 5; if [ $(ls /var/run/openvswitch/ | wc -l) = 0 ]; then kill $(ps -ef | grep opflex_supervisor[d] | awk '{print $3}'); fi; done"
